{% extends 'main/base.html' %}

{% block title %}Глобальные аллергены{% endblock %}

{% block content %}
<section class="card" style="max-width: 860px; margin: 0 auto;">
    <div class="inline-actions" style="justify-content: space-between; align-items: baseline;">
        <div>
            <p class="pill">Администратор</p>
            <h2 class="title" style="margin: 6px 0 0;">Добавить глобальный аллерген</h2>
            <p class="muted" style="margin-top: 6px;">Глобальные аллергены доступны всем пользователям сервиса.</p>
        </div>
        <a class="back-link" href="{% url 'home' %}">← В основное меню</a>
    </div>

    {% if user.is_staff %}
    <form method="post" style="margin-top: 16px;">
        {% csrf_token %}
        {{ form.as_p }}
        <button class="btn btn-primary" type="submit">Добавить глобальный аллерген</button>
    </form>
    {% else %}
    <div class="card" style="margin-top: 16px; background: var(--bg-secondary);">
        <p class="muted" style="margin: 0;">Только администраторы могут добавлять и изменять глобальные аллергены.</p>
    </div>
    {% endif %}

    <h3 class="section-title">Существующие глобальные аллергены</h3>
    <ul class="chip-list">
        {% for a in allergens %}
            <li style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                <span>{{ a.name }}</span>
                <span class="badge">добавил: {{ a.created_by.username }}</span>
                {% if user.is_staff %}
                <span style="margin-left: auto; display: inline-flex; gap: 6px;">
                    <a class="btn btn-ghost" href="{% url 'global_allergen_edit' a.pk %}">Изменить</a>
                    <form method="post" action="{% url 'global_allergen_delete' a.pk %}" style="margin: 0;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger" onclick="return confirm('Удалить глобальный аллерген «{{ a.name }}»?');">Удалить</button>
                    </form>
                </span>
                {% endif %}
            </li>
        {% empty %}
            <li class="muted">Нет глобальных аллергенов</li>
        {% endfor %}
    </ul>
</section>
{% endblock %}